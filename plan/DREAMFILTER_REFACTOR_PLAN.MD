# üß† VALIS Memory System Refactor Plan: Integrating the Dreamfilter Layer

## OBJECTIVE

Integrate a subconscious symbolic interface (Dreamfilter) into VALIS' existing 5-Layer Memory System by refining memory function roles and inserting an overlay-processing layer before LLM output.

---

## CURRENT LAYERED MODEL (Sprint 6)

1. **Core Persona** - Immutable identity
2. **Canonized Identity** - Persona #canon facts
3. **Client Profile** - Per-user #client\_fact facts
4. **Working Memory** - Short-term FIFO thought space
5. **Session History** - Live message context

---

## REIMAGINED MEMORY + DREAMFILTER PIPELINE

### üí° ADDITION: Dreamfilter Layer ("Unconscious Interpreter")

Positioned between Prompt Composition and Provider Output.

```plaintext
[User Input]
 ‚Ü≥ Prompt Composer: memory‚Üímessage bridge
   ‚Ü≥ Working Memory Injection
     ‚Ü≥ DREAMFILTER(): unconscious modulator
       ‚Ü≥ Augmented Response ‚Üí Provider
```

### üîÅ MODIFIED MEMORY ROLES

#### üî∏ Core Persona

* Static facts (as-is)

#### üî∏ Canonized Identity

* Expanded to include symbolic anchors (#symbol)
* E.g., "Proteus fears stagnation" tagged with `#canon #symbol`

#### üî∏ Client Profile

* Expanded to hold emotional tone indicators (optional)
* Enables Dreamfilter to mirror user state

#### üî∏ Working Memory

* Treated as LLM-subconscious buffer
* Patterns and language motifs may be pulled to shape symbolic layers
* Memory entries tagged as `#dream`, `#mood`, `#fragment`, etc.

#### üî∏ Session History

* Used for semantic echo/resonance detection
* Auto-suggest metaphor bridges via dreamfilter

---

## ADDITIONAL MODULES TO BUILD

### ‚úÖ `dreamfilter.py`

* Symbol substitution engine
* Pattern injection based on WM
* Tone inflector / stylistic overlay

### ‚úÖ `symbolic_memory_utils.py`

* Tools for marking motifs from Working Memory
* Suggest dream-mode entries and canonical upgrades

### ‚úÖ `config/dreamfilter.json`

```json
{
  "mode": "mythic",
  "symbolic_density": 0.7,
  "allow_shadow_reflection": true
}
```

---

## DEV PRIORITY PLAN

| Sprint | Task                                                       |
| ------ | ---------------------------------------------------------- |
| 9.1    | Prototype `dreamfilter.py`, tie into prompt\_composer      |
| 9.2    | Tag & filter Working Memory entries with symbolic metadata |
| 9.3    | Create dreamfilter toggle logic in config handler          |
| 9.4    | Tune dreamfilter response effect using dev personas        |

---

## LONG TERM

This paves the way for dream memory surfaces, shared unconscious motifs between personas, and symbolic mirroring loops.

**VALIS evolves from memory-aware to myth-aware.**